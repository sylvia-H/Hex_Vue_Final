"use strict";(self["webpackChunkhealthy_diet"]=self["webpackChunkhealthy_diet"]||[]).push([[892],{5372:function(t,e,n){n.r(e),n.d(e,{default:function(){return $t}});var o=n(6252),a=n(3577);const i={class:"container"},s={class:"row py-3"},l={class:"col-12"},d={class:"d-flex justify-content-between mx-6 my-8"},p=(0,o._)("h2",null,"優惠券列表",-1),c={class:"table-responsive"},u={class:"table table-hover mt-4 text-center"},r=(0,o._)("thead",null,[(0,o._)("tr",null,[(0,o._)("th",null,"優惠券主題"),(0,o._)("th",null,"優惠碼"),(0,o._)("th",null,"折扣百分比"),(0,o._)("th",null,"優惠到期日"),(0,o._)("th",null,"是否啟用"),(0,o._)("th",null,"編輯")])],-1),m=["onClick"],h=["onClick"],_={class:"btn-group",role:"group"},b=["onClick"],g=(0,o._)("i",{class:"bi bi-pencil-square"},null,-1),f=[g],w=["onClick"],C=(0,o._)("i",{class:"bi bi-trash"},null,-1),y=[C],v=(0,o.Uk)(" 目前有 "),k=(0,o.Uk)(" 種優惠券 "),I=(0,o._)("br",null,null,-1);function x(t,e,n,g,C,x){const $=(0,o.up)("VueLoader"),D=(0,o.up)("VLoading"),M=(0,o.up)("PaginationCoupons"),L=(0,o.up)("ModalCoupon");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o.Wm)(D,{active:C.isLoading,"z-index":1e3},{default:(0,o.w5)((()=>[(0,o.Wm)($)])),_:1},8,["active"]),(0,o._)("div",i,[(0,o._)("div",s,[(0,o._)("div",l,[(0,o._)("div",d,[p,(0,o._)("button",{type:"button",class:"btn btn-outline-dark",onClick:e[0]||(e[0]=t=>x.openCouponModal(1,{}))}," 新增優惠券 ")]),(0,o._)("div",c,[(0,o._)("table",u,[r,(0,o._)("tbody",null,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(C.coupons,(n=>((0,o.wg)(),(0,o.iD)("tr",{key:n.code},[(0,o._)("td",null,(0,a.zw)(n.title),1),(0,o._)("td",null,(0,a.zw)(n.code),1),(0,o._)("td",null,(0,a.zw)(n.percent)+" %",1),(0,o._)("td",null,(0,a.zw)(t.$filters.transferTime(n.due_date)),1),(0,o._)("td",null,[n.is_enabled?((0,o.wg)(),(0,o.iD)("span",{key:0,onClick:t=>x.changeStatus(n.id),onKeydown:e[1]||(e[1]=(...e)=>t.enter&&t.enter(...e)),class:"btn btn-success py-2 px-2 rounded"}," 啟用 ",40,m)):((0,o.wg)(),(0,o.iD)("span",{key:1,onClick:t=>x.changeStatus(n.id),onKeydown:e[2]||(e[2]=(...e)=>t.enter&&t.enter(...e)),class:"btn btn-dark py-2 px-2 rounded"}," 未啟用 ",40,h))]),(0,o._)("td",null,[(0,o._)("div",_,[(0,o._)("button",{type:"button",class:"btn btn-warning",onClick:t=>x.openCouponModal(0,n)},f,8,b),(0,o._)("button",{type:"button",class:"btn btn-danger",onClick:t=>x.delCoupon(n)},y,8,w)])])])))),128))])])]),(0,o._)("p",null,[v,(0,o._)("span",null,(0,a.zw)(C.coupons.length),1),k]),I,(0,o.Wm)(M,{pagination:C.pagination,class:"d-flex justify-content-center",onGetCoupons:x.getCoupons},null,8,["pagination","onGetCoupons"]),(0,o.Wm)(L,{coupon:C.tempItemInfo,is_addNewCoupon:C.is_addNewCoupon,ref:"editCouponModal",onEditCoupon:x.editCoupon},null,8,["coupon","is_addNewCoupon","onEditCoupon"])])])])],64)}var $=n(9963);const D={"aria-label":"Page navigation"},M={class:"pagination"},L=(0,o._)("span",{"aria-hidden":"true"},"«",-1),N=[L],U=["onClick"],R=(0,o._)("span",{"aria-hidden":"true"},"»",-1),V=[R];function z(t,e,n,i,s,l){return(0,o.wg)(),(0,o.iD)("nav",D,[(0,o._)("ul",M,[(0,o._)("li",{class:(0,a.C_)(["page-item",{disabled:!n.pagination.has_pre}])},[(0,o._)("a",{class:"page-link",href:"#","aria-label":"Previous",onClick:e[0]||(e[0]=(0,$.iM)((e=>t.$emit("get-coupons",n.pagination.current_page-1)),["prevent"]))},N)],2),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(n.pagination.total_pages,((e,i)=>((0,o.wg)(),(0,o.iD)("li",{class:(0,a.C_)(["page-item",{active:e===n.pagination.current_page}]),key:i},[(0,o._)("a",{class:"page-link",href:"#",onClick:(0,$.iM)((n=>t.$emit("get-coupons",e)),["prevent"])},(0,a.zw)(e),9,U)],2)))),128)),(0,o._)("li",{class:(0,a.C_)(["page-item",{disabled:!n.pagination.has_next}])},[(0,o._)("a",{class:"page-link",href:"#","aria-label":"Next",onClick:e[1]||(e[1]=(0,$.iM)((e=>t.$emit("get-coupons",n.pagination.current_page+1)),["prevent"]))},V)],2)])])}var T={name:"PaginationCoupons",props:["pagination"]},B=n(3744);const S=(0,B.Z)(T,[["render",z]]);var q=S;const E={id:"couponModal",class:"modal fade",tabindex:"-1","aria-labelledby":"couponModalLabel","aria-hidden":"true"},P={class:"modal-dialog modal-dialog-centered"},K={class:"modal-content border-0"},W=(0,o._)("div",{class:"modal-header bg-dark text-white"},[(0,o._)("h5",{class:"modal-title"},[(0,o._)("span",null,"新增優惠券")]),(0,o._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Z={class:"modal-body"},j={class:"row"},H={class:"col-12"},Y={class:"row"},G={class:"col-10 offset-1"},J={class:"bg-secondary text-light text-center rounded p-4 mb-4"},O={class:"d-flex justify-content-between align-items-center mb-3"},A=(0,o._)("h5",{class:"mb-3 me-3"},"優惠券代碼亂數產生器",-1),F={class:"input-group mb-3"},Q=(0,o._)("span",{class:"material-icons"}," content_copy ",-1),X=[Q],tt={class:"col-12"},et={for:"title",class:"form-label w-100 mb-4"},nt=(0,o.Uk)(" 優惠券主題名稱 "),ot={for:"code",class:"form-label w-100 mb-4"},at=(0,o.Uk)(" 優惠券代碼 "),it={for:"percent",class:"form-label w-100 mb-4"},st=(0,o.Uk)(" 優惠折扣百分比 "),lt={for:"due_date",class:"form-label w-100 mb-4"},dt=(0,o.Uk)(" 優惠到期日 "),pt={for:"check_enabled",class:"form-check-label w-100 mb-4"},ct={key:0,class:"text-success"},ut=(0,o._)("b",null,"已啟用",-1),rt=[ut],mt={key:1,class:"text-danger"},ht={class:"modal-footer"},_t=(0,o._)("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function bt(t,e,n,a,i,s){return(0,o.wg)(),(0,o.iD)("div",E,[(0,o._)("div",P,[(0,o._)("div",K,[W,(0,o._)("div",Z,[(0,o._)("div",j,[(0,o._)("div",H,[(0,o._)("div",Y,[(0,o._)("div",G,[(0,o._)("div",J,[(0,o._)("div",O,[A,(0,o._)("button",{type:"button",class:"btn btn-dark mb-3",onClick:e[0]||(e[0]=(...t)=>s.genRandom&&s.genRandom(...t))}," 產生亂數代碼 ")]),(0,o._)("div",F,[(0,o.wy)((0,o._)("input",{type:"text",class:"form-control",id:"textRandom","onUpdate:modelValue":e[1]||(e[1]=t=>i.textRandom=t),"aria-label":"亂數代碼回傳結果",placeholder:"亂數代碼回傳結果"},null,512),[[$.nr,i.textRandom]]),(0,o._)("button",{type:"button",class:"input-group-text",id:"btn_copyLink",onClick:e[2]||(e[2]=t=>s.copyText()),"data-clipboard-target":"#textRandom"},X)])])]),(0,o._)("div",tt,[(0,o._)("label",et,[nt,(0,o.wy)((0,o._)("input",{id:"title",type:"text",class:"form-control",placeholder:"請輸入優惠券名稱","onUpdate:modelValue":e[3]||(e[3]=t=>i.tempItem.title=t),required:""},null,512),[[$.nr,i.tempItem.title]])]),(0,o._)("label",ot,[at,(0,o.wy)((0,o._)("input",{id:"code",type:"text",class:"form-control",placeholder:"請輸入優惠券代碼","onUpdate:modelValue":e[4]||(e[4]=t=>i.tempItem.code=t),required:""},null,512),[[$.nr,i.tempItem.code]])]),(0,o._)("label",it,[st,(0,o.wy)((0,o._)("input",{id:"percent",type:"number",min:"0",max:"100",class:"form-control",placeholder:"請輸入 0 ~ 100 %","onUpdate:modelValue":e[5]||(e[5]=t=>i.tempItem.percent=t),required:""},null,512),[[$.nr,i.tempItem.percent]])]),(0,o._)("label",lt,[dt,(0,o.wy)((0,o._)("input",{id:"due_date",type:"datetime-local",class:"form-control","onUpdate:modelValue":e[6]||(e[6]=t=>i.tempDate=t),required:""},null,512),[[$.nr,i.tempDate]])]),(0,o._)("label",pt,[(0,o.wy)((0,o._)("input",{id:"check_enabled",type:"checkbox",class:"form-check-input me-2","true-value":1,"false-value":0,"onUpdate:modelValue":e[7]||(e[7]=t=>i.tempItem.is_enabled=t)},null,512),[[$.e8,i.tempItem.is_enabled]]),i.tempItem.is_enabled?((0,o.wg)(),(0,o.iD)("span",ct,rt)):((0,o.wg)(),(0,o.iD)("span",mt,"未啟用"))])])])])])]),(0,o._)("div",ht,[_t,n.is_addNewCoupon?((0,o.wg)(),(0,o.iD)("button",{key:0,type:"button",class:"btn btn-primary",onClick:e[8]||(e[8]=e=>{s.closeModal(),t.$emit("editCoupon",i.tempItem)})}," 新增優惠券 ")):((0,o.wg)(),(0,o.iD)("button",{key:1,type:"button",class:"btn btn-success",onClick:e[9]||(e[9]=e=>{s.closeModal(),t.$emit("editCoupon",i.tempItem)})}," 修改優惠券內容 "))])])])])}var gt=n(7244),ft=n(2152),wt=n.n(ft),Ct={name:"ModalCoupon",props:["coupon","is_addNewCoupon"],watch:{coupon(){this.tempItem=JSON.parse(JSON.stringify(this.coupon)),this.tempItem.is_enabled||(this.tempItem.is_enabled=0),this.tempDate=this.$filters.transferToDate(this.tempItem.due_date)},tempDate(){this.tempItem.due_date=+new Date(this.tempDate)/1e3}},data(){return{modal:"",tempItem:{is_enabled:0},tempDate:"",textRandom:""}},methods:{openModal(){this.modal.show()},closeModal(){this.modal.hide()},genRandom(){const t="0123456789",e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",n="#$*_",o=(t+e+n).split("");let a="";for(let i=0;i<10;i+=1)a+=o[Math.floor(Math.random()*o.length)];this.textRandom=a},copyText(){const t=new(wt())("#btn_copyLink");t.on("success",(t=>{t.clearSelection()}))},organizeData(){this.tempItem=this.coupon,this.tempItem.is_enabled||(this.tempItem.is_enabled=0),this.tempItem.due_date&&(this.tempDate=this.$filters.transferToDate(this.tempItem.due_date))}},mounted(){this.modal=new gt.u_(document.getElementById("couponModal"))}};const yt=(0,B.Z)(Ct,[["render",bt]]);var vt=yt,kt=n(4739),It={data(){return{isLoading:!1,coupons:[],pagination:{},tempItemInfo:{},is_addNewCoupon:0}},components:{ModalCoupon:vt,PaginationCoupons:q,VueLoader:kt.Z},methods:{getCoupons(t=1){this.isLoading=!0,this.$http.get(`https://vue3-course-api.hexschool.io/v2/api/sylviah/admin/coupons?page=${t}`).then((t=>{this.coupons=t.data.coupons,this.pagination=t.data.pagination,this.isLoading=!1})).catch((()=>{this.isLoading=!1}))},changeStatus(t){this.coupons.forEach((e=>{const n=e;n.id===t&&(n.is_enabled?n.is_enabled=0:n.is_enabled=1,this.is_addNewCoupon=0,this.editCoupon(n,t))}))},editCoupon(t,e){this.isLoading=!0,t&&(this.tempItemInfo=t);const n={data:this.tempItemInfo};let o="",a="";this.is_addNewCoupon?(o="post",a="https://vue3-course-api.hexschool.io/v2/api/sylviah/admin/coupon"):(o="put",a=`https://vue3-course-api.hexschool.io/v2/api/sylviah/admin/coupon/${this.tempItemInfo.id||e}`),this.$http[o](a,n).then((()=>{this.isLoading=!1,this.getCoupons(this.pagination.current_page),"post"===o?this.$swal.fire({icon:"success",title:"成功！",text:`成功新增 ${this.tempItemInfo.title}`}):this.$swal.fire({icon:"success",title:"成功！",text:`已更新 ${this.tempItemInfo.title} 的資訊`})})).catch((t=>{this.isLoading=!1;const e=t.response.data.message;let n="";e.forEach((t=>{n+=`${t}。\n`})),this.$swal.fire({icon:"error",title:"失敗！請重新輸入資訊。",text:n})}))},delCoupon(t){let e,n,o;if(t){this.tempItemInfo=t;const a=this.tempItemInfo.id;e=`https://vue3-course-api.hexschool.io/v2/api/sylviah/admin/coupon/${a}`,n="優惠券",o=`優惠券刪除後將無法恢復。優惠券編號：${this.tempItemInfo.id}。`}else e="https://vue3-course-api.hexschool.io/v2/api/sylviah/admin/coupon",n="所有優惠券",o="優惠券刪除後將無法恢復。";this.$swal.fire({title:`確定要刪除 ${n} 嗎？`,text:o,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"確定刪除！",cancelButtonText:"取消"}).then((t=>{t.isConfirmed&&(this.isLoading=!0,this.$http.delete(e).then((()=>{this.isLoading=!1,this.getCoupons(this.pagination.current_page),this.$swal.fire({icon:"success",title:"成功！",text:`已刪除 ${n}`})})).catch((()=>{this.$swal.fire({icon:"error",title:"刪除失敗！",text:"請再試一次"})})))}))},openCouponModal(t,e){this.is_addNewCoupon=t,this.tempItemInfo=e,this.$refs.editCouponModal.openModal(e)}},mounted(){this.getCoupons()}};const xt=(0,B.Z)(It,[["render",x]]);var $t=xt}}]);
//# sourceMappingURL=892.76b4263f.js.map